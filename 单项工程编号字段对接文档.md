# 单项工程编号字段（projectWorkCode）后端及数据库对接文档

## 一、概述

前端新增"单项工程编号"字段，用于标识单项工程的唯一编号。该字段需要后端和数据库同步支持。

### 字段信息

| 字段名 | 类型 | 说明 | 必填 |
|--------|------|------|------|
| projectWorkCode | String | 单项工程编号 | 否 |

### 字段用途

区分"单项工程"和"单位工程"的编号：
- **单项工程名称**（workName）：如"主体结构工程"
- **单项工程编号**（projectWorkCode）：如"DX-2024-001" ⬅️ **新增字段**
- **单位工程名称**（unitWork）：如"第一施工段"
- **单位工程编号**（workCode）：如"CTZH-2024-001-ZTJ"

---

## 二、数据库修改

### 2.1 表结构变更

在 `works` 表中添加新字段：

```sql
-- MySQL
ALTER TABLE `works` 
ADD COLUMN `project_work_code` VARCHAR(100) DEFAULT NULL COMMENT '单项工程编号' 
AFTER `work_name`;

-- 添加索引（可选，如需按编号查询）
CREATE INDEX `idx_project_work_code` ON `works` (`project_work_code`);
```

```sql
-- PostgreSQL
ALTER TABLE works 
ADD COLUMN project_work_code VARCHAR(100) DEFAULT NULL;

COMMENT ON COLUMN works.project_work_code IS '单项工程编号';
```

### 2.2 字段说明

| 列名 | 类型 | 允许空 | 默认值 | 说明 |
|------|------|--------|--------|------|
| project_work_code | VARCHAR(100) | YES | NULL | 单项工程编号 |

---

## 三、API 接口修改

### 3.1 新增工程接口

**接口地址**：`POST /api/works`

**请求参数**（新增字段高亮）：

```json
{
  "projectId": 1,
  "workName": "主体结构工程",
  "projectWorkCode": "DX-2024-001",  // ⬅️ 新增字段
  "unitWork": "第一施工段",
  "workCode": "CTZH-2024-001-ZTJ",
  "startDate": "2024-01-01",
  "endDate": "2024-12-31",
  "color": "#0d9488",
  "description": "工程描述"
}
```

### 3.2 更新工程接口

**接口地址**：`PUT /api/works/{id}`

**请求参数**（新增字段高亮）：

```json
{
  "workName": "主体结构工程",
  "projectWorkCode": "DX-2024-001",  // ⬅️ 新增字段
  "unitWork": "第一施工段",
  "workCode": "CTZH-2024-001-ZTJ",
  "startDate": "2024-01-01",
  "endDate": "2024-12-31"
}
```

### 3.3 获取工程详情接口

**接口地址**：`GET /api/works/{id}`

**返回数据**（新增字段高亮）：

```json
{
  "id": 1,
  "projectId": 1,
  "workName": "主体结构工程",
  "projectWorkCode": "DX-2024-001",  // ⬅️ 新增字段
  "unitWork": "第一施工段",
  "workCode": "CTZH-2024-001-ZTJ",
  "startDate": "2024-01-01",
  "endDate": "2024-12-31",
  "color": "#0d9488",
  "description": "工程描述",
  "createdAt": "2024-01-01T00:00:00Z",
  "updatedAt": "2024-01-01T00:00:00Z"
}
```

### 3.4 获取工程列表接口

**接口地址**：`GET /api/works`

**返回数据**（每个工程对象新增字段）：

```json
{
  "list": [
    {
      "id": 1,
      "projectId": 1,
      "workName": "主体结构工程",
      "projectWorkCode": "DX-2024-001",  // ⬅️ 新增字段
      "unitWork": "第一施工段",
      "workCode": "CTZH-2024-001-ZTJ",
      "startDate": "2024-01-01",
      "endDate": "2024-12-31",
      "color": "#0d9488"
    }
  ],
  "total": 1,
  "page": 1,
  "pageSize": 20
}
```

---

## 四、后端代码修改示例

### 4.1 实体类/模型（Java Spring Boot）

```java
@Entity
@Table(name = "works")
public class Work {
    // ... 其他字段
    
    @Column(name = "work_name")
    private String workName;
    
    @Column(name = "project_work_code")  // ⬅️ 新增字段
    private String projectWorkCode;
    
    @Column(name = "unit_work")
    private String unitWork;
    
    @Column(name = "work_code")
    private String workCode;
    
    // ... getter/setter
}
```

### 4.2 实体类/模型（Node.js Sequelize）

```javascript
const Work = sequelize.define('Work', {
  // ... 其他字段
  
  workName: {
    type: DataTypes.STRING(200),
    field: 'work_name',
    allowNull: false
  },
  projectWorkCode: {  // ⬅️ 新增字段
    type: DataTypes.STRING(100),
    field: 'project_work_code',
    allowNull: true
  },
  unitWork: {
    type: DataTypes.STRING(200),
    field: 'unit_work',
    allowNull: true
  },
  workCode: {
    type: DataTypes.STRING(100),
    field: 'work_code',
    allowNull: true
  }
}, {
  tableName: 'works'
});
```

### 4.3 实体类/模型（Python Django）

```python
class Work(models.Model):
    # ... 其他字段
    
    work_name = models.CharField(max_length=200, verbose_name='单项工程名称')
    project_work_code = models.CharField(max_length=100, null=True, blank=True, verbose_name='单项工程编号')  # ⬅️ 新增字段
    unit_work = models.CharField(max_length=200, null=True, blank=True, verbose_name='单位工程名称')
    work_code = models.CharField(max_length=100, null=True, blank=True, verbose_name='单位工程编号')
    
    class Meta:
        db_table = 'works'
```

---

## 五、字段映射关系

| 前端字段名 | 后端字段名 | 数据库列名 | 中文说明 |
|-----------|-----------|------------|----------|
| workName | workName | work_name | 单项工程名称 |
| **projectWorkCode** | **projectWorkCode** | **project_work_code** | **单项工程编号（新增）** |
| unitWork | unitWork | unit_work | 单位工程名称 |
| workCode | workCode | work_code | 单位工程编号 |

---

## 六、前端涉及页面

已完成前端适配的页面：

1. **添加工程页面** (`pages/add-work/add-work.vue`)
   - 新增单项工程编号输入框

2. **工程列表页面** (`pages/works/works.vue`)
   - 列表显示单项工程编号

3. **项目详情页面** (`pages/project-detail/project-detail.vue`)
   - 显示和编辑单项工程编号

4. **日志预览页面** (`pages/log-preview/log-preview.vue`)
   - 显示单项工程编号

5. **日志填写页面** (`pages/log-page/log-page.vue`)
   - 工程信息中包含单项工程编号

---

## 七、测试要点

### 7.1 功能测试

- [ ] 新增工程时可填写单项工程编号
- [ ] 编辑工程时可修改单项工程编号
- [ ] 工程列表正确显示单项工程编号
- [ ] 工程详情正确显示单项工程编号
- [ ] 单项工程编号为空时正常处理（非必填字段）

### 7.2 数据验证

- [ ] 数据库正确存储 project_work_code 字段
- [ ] API 返回数据包含 projectWorkCode 字段
- [ ] 字段长度限制（建议最大100字符）

---

## 八、版本信息

- **文档版本**：v1.0
- **创建日期**：2025-11-29
- **前端完成状态**：✅ 已完成
- **后端完成状态**：✅ 已完成
- **数据库完成状态**：✅ 已完成

---

## 九、联系方式

如有疑问，请联系前端开发人员。
